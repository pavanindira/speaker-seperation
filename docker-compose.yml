version: '3.8'

services:
  speaker-separator:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: speaker-separator-api
    ports:
      - "8900:8900"
    volumes:
      - ./conversation_output:/app/conversation_output
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./data:/app/data
      - ./data/test.mpeg:/app/data/test.mpeg:ro
      - ./data/DIALOGUE.ogg:/app/data/DIALOGUE.ogg:ro
      # UI + app code (so you don't need rebuilds for template/JS changes)
      - ./templates:/app/templates:ro
      - ./static:/app/static:ro
      - ./final_speaker_api.py:/app/final_speaker_api.py:ro
      - ./audio_cleaner.py:/app/audio_cleaner.py:ro
      - ./improved_speaker_separator.py:/app/improved_speaker_separator.py:ro
      - ./final_speaker_frontend.py:/app/final_speaker_frontend.py:ro
    environment:
      - OLLAMA_URL=${OLLAMA_URL:-http://192.168.1.33:11434}
      - API_PORT=8900
      - PYTHONUNBUFFERED=1
    networks:
      - vocal-network
    # Note: --reload enables auto-restart on file changes for development.
    # For production, remove --reload and rebuild the image.
    command: python final_speaker_api.py --host 0.0.0.0 --port 8900 --reload

networks:
  vocal-network:
    driver: bridge
