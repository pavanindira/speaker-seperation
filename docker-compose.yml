version: '3.8'

services:
  speaker-separator:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: speaker-separator-api
    ports:
      - "8900:8900"
    volumes:
      # Mount entire project root for development (read-write)
      - .:/app:rw
      # Persist these directories across container restarts
      - conversation_output-data:/app/conversation_output
      - uploads-data:/app/uploads
      - outputs-data:/app/outputs
      - temp-data:/app/temp
      - logs-data:/app/logs
    environment:
      - OLLAMA_URL=${OLLAMA_URL:-http://192.168.1.33:11434}
      - API_PORT=8900
      - PYTHONUNBUFFERED=1
    networks:
      - vocal-network
    # Note: --reload enables auto-restart on file changes for development.
    # For production, remove --reload and rebuild the image.
    command: python final_speaker_api.py --host 0.0.0.0 --port 8900 --reload

networks:
  vocal-network:
    driver: bridge

volumes:
  conversation_output-data:
  uploads-data:
  outputs-data:
  temp-data:
  logs-data:
